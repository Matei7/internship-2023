/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/js/checkout.js":
/*!****************************!*\
  !*** ./src/js/checkout.js ***!
  \****************************/
/***/ (() => {

eval("let checkoutWindow = document.querySelector(\".checkout-window__grid\");\r\nlet totalText = document.querySelector(\".checkout-window-total\");\r\nlet productsArrayAfterUpdateAProduct = [];\r\nconst idCart = \"64c77ddd8e88f\";\r\n\r\nlet changedQuantityForProduct = 0;\r\n\r\n\r\nfunction fetchCart() {\r\n    return fetch(`https://vlad-matei.thrive-dev.bitstoneint.com/wp-json/internship-api/v1/cart/${idCart}`, {\r\n        method: 'GET',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n        }\r\n    })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                throw new Error(`Request failed with status ${response.status}`);\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(data => {\r\n            return data.products;\r\n        })\r\n        .catch(error => {\r\n            console.error('Error fetching cart products:', error);\r\n            return [];\r\n        });\r\n}\r\n\r\nfunction createItemBoxCheckout(product) {\r\n    let boxItem = document.createElement(\"div\");\r\n    boxItem.classList.add(\"checkout-window__grid__box-item\");\r\n    boxItem.setAttribute(\"data-id\", product.id);\r\n    const price = (product.price - (product.price * product.discountPercentage) / 100).toFixed(2);\r\n    let hmtlPart = `\r\n        <img src=${product.thumbnail} alt=\"Product Image\" class=\"box-item__image\">\r\n        <p class=\"box-item__title\">${product.title}</p>\r\n        <p class=\"box-item__price\">${price}</p>\r\n        <div class=\"quantity buttons_added\">\r\n          <input type=\"button\" value=\"-\" class=\"minus\">\r\n          <input type=\"number\" step=\"1\" min=\"1\" max=\"\" value=${product.quantity}  class=\"input-text qty text\" size=\"4\" >\r\n          <input type=\"button\" value=\"+\" class=\"plus\">\r\n        </div>\r\n        <p class=\"box-item__total-price\"> ${(product.quantity * price).toFixed(2)}</p>\r\n      </div>`;\r\n    boxItem.innerHTML = hmtlPart;\r\n    return boxItem;\r\n}\r\n\r\nfunction debounce(func, timeout = 700) {\r\n    let timer;\r\n    return (...args) => {\r\n        clearTimeout(timer);\r\n        changedQuantityForProduct++;\r\n        timer = setTimeout(() => {\r\n            func.apply(this, args);\r\n        }, timeout);\r\n    };\r\n}\r\n\r\nconst changes = debounce(async (productId, operation) => {\r\n    await modifyQuantity(productId, operation);\r\n    changedQuantityForProduct = 0;\r\n})\r\n\r\n\r\nasync function modifyQuantity(productId, operation) {\r\n    if (operation === \"increase\") {\r\n        increaseQuantityRequest(productId, changedQuantityForProduct);\r\n    } else {\r\n        decreaseQuantityRequest(productId, changedQuantityForProduct);\r\n    }\r\n}\r\n\r\n\r\nfunction plusMinusBtnListener(card) {\r\n    const plusBtn = card.querySelector(\".plus\");\r\n    const minusBtn = card.querySelector(\".minus\");\r\n    const quantity = card.querySelector(\".input-text.qty.text\");\r\n    plusBtn.addEventListener(\"click\", () => {\r\n        changes(card.dataset.id, \"increase\");\r\n    });\r\n\r\n    minusBtn.addEventListener(\"click\", function () {\r\n        changes(card.dataset.id, \"decrease\");\r\n    });\r\n}\r\n\r\n\r\nasync function increaseQuantityRequest(productId, quantity = 1) {\r\n    try {\r\n        await fetch(`https://vlad-matei.thrive-dev.bitstoneint.com/wp-json/internship-api/v1/cart/${idCart}`, {\r\n            method: 'POST',\r\n            headers: {'Content-Type': 'application/json'},\r\n            body: JSON.stringify({\r\n                products: [\r\n                    {\r\n                        id: productId,\r\n                        quantity: quantity\r\n                    }\r\n                ]\r\n            })\r\n        });\r\n        const productToUpdate = productsArrayAfterUpdateAProduct.find(product => product.id === Number(productId));\r\n        if (productToUpdate) {\r\n            productToUpdate.quantity += quantity;\r\n        }\r\n        updateQuantityProducts();\r\n    } catch (error) {\r\n        console.error('Error increasing product quantity:', error);\r\n    }\r\n}\r\n\r\n\r\nasync function decreaseQuantityRequest(productId, quantity = 1) {\r\n    const productToUpdate = productsArrayAfterUpdateAProduct.find(product => product.id === Number(productId));\r\n    if (productToUpdate && productToUpdate.quantity + (-1) * quantity < 1) {\r\n        try {\r\n            await fetch(`https://vlad-matei.thrive-dev.bitstoneint.com/wp-json/internship-api/v1/cart/${idCart}?products[]=${productId}`, {\r\n                method: 'DELETE',\r\n                headers: {'Content-Type': 'application/json'},\r\n            });\r\n            productsArrayAfterUpdateAProduct = productsArrayAfterUpdateAProduct.filter(product => product.id !== Number(productId));\r\n            updateQuantityProducts();\r\n            checkoutWindow.removeChild(document.querySelector(`.checkout-window__grid__box-item[data-id=\"${productId}\"]`));\r\n        } catch (error) {\r\n            console.error('Error deleting product:', error);\r\n        }\r\n    } else {\r\n        try {\r\n            await fetch(`https://vlad-matei.thrive-dev.bitstoneint.com/wp-json/internship-api/v1/cart/${idCart}`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({\r\n                    products: [\r\n                        {\r\n                            id: productId,\r\n                            quantity: -1 * quantity,\r\n                        }\r\n                    ]\r\n                })\r\n            });\r\n            const productToUpdate = productsArrayAfterUpdateAProduct.find(product => product.id === Number(productId));\r\n            if (productToUpdate) {\r\n                productToUpdate.quantity -= quantity;\r\n            }\r\n            updateQuantityProducts();\r\n        } catch (error) {\r\n            console.error('Error updating product quantity:', error);\r\n        }\r\n    }\r\n}\r\n\r\nasync function updateQuantityProducts() {\r\n    try {\r\n        const total = productsArrayAfterUpdateAProduct.reduce((acc, product) => {\r\n            const price = product.price - (product.price * product.discountPercentage) / 100;\r\n            const totalPrice = product.quantity * price;\r\n            return acc + totalPrice;\r\n        }, 0);\r\n        productsArrayAfterUpdateAProduct.forEach(product => {\r\n            const itemBox = document.querySelector(`.checkout-window__grid__box-item[data-id=\"${product.id}\"]`);\r\n            const itemQuantity = itemBox.querySelector(\".input-text.qty.text\");\r\n            const itemTotalPrice = itemBox.querySelector(\".box-item__total-price\");\r\n            itemQuantity.value = product.quantity;\r\n            const price = product.price - (product.price * product.discountPercentage) / 100;\r\n            itemTotalPrice.textContent = `${(product.quantity * price).toFixed(2)}`\r\n        });\r\n        totalText.innerText = total.toFixed(2);\r\n    } catch (error) {\r\n        console.error('Error updating quantity products:', error);\r\n    }\r\n}\r\n\r\n\r\nasync function showCheckoutProducts() {\r\n    fetchCart()\r\n        .then(productsFromCart => {\r\n            for (const product of productsFromCart) {\r\n                let card = createItemBoxCheckout(product);\r\n                checkoutWindow.appendChild(card);\r\n                plusMinusBtnListener(card);\r\n            }\r\n            productsArrayAfterUpdateAProduct = productsFromCart;\r\n            const total = productsArrayAfterUpdateAProduct.reduce((acc, product) => {\r\n                const price = product.price - (product.price * product.discountPercentage) / 100;\r\n                return acc + product.quantity * price;\r\n            }, 0);\r\n            totalText.textContent = total.toFixed(2);\r\n        })\r\n        .catch(error => {\r\n            console.error('Error show cart items:', error);\r\n        });\r\n}\r\n\r\nfunction generalListenerOnPage() {\r\n    const buyButton = document.querySelector(\".checkout-window__button\");\r\n    buyButton.addEventListener(\"click\", async () => {\r\n        const cart = document.querySelector(\".checkout-section\");\r\n        setTimeout(\r\n            function () {\r\n                cart.style.display = \"none\";\r\n            }, 3000);\r\n            alert(\"Thank you for your order! Have a nice day!\");\r\n            await fetch(`https://vlad-matei.thrive-dev.bitstoneint.com/wp-json/internship-api/v1/cart/${idCart}`, {\r\n                method: 'DELETE',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                }\r\n            })\r\n        }\r\n    );\r\n\r\n\r\n    const titleShop = document.getElementById(\"meta-shop\");\r\n    titleShop.addEventListener(\"click\", () => {\r\n        window.location.href = \"index.html\";\r\n    });\r\n}\r\n\r\n\r\nshowCheckoutProducts();\r\ngeneralListenerOnPage();\n\n//# sourceURL=webpack://internship-2023/./src/js/checkout.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/js/checkout.js"]();
/******/ 	
/******/ })()
;